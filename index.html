<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simulador DEA - con ResponsiveVoice</title>

<!-- ðŸŽ™ï¸ ResponsiveVoice: voz online inmediata -->
<script src="https://code.responsivevoice.org/responsivevoice.js?key=YOUR_KEY"></script>

<style>
:root{
  --bg:#0b0f14; --panel:#111722; --accent:#2dd4bf; --accent2:#60a5fa; --warn:#ef4444; --ok:#22c55e; --muted:#94a3b8; --text:#e5e7eb;
}
*{box-sizing:border-box;}
body{margin:0;background:linear-gradient(180deg,#0b0f14,#0a0d12);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;}
.app{display:grid;grid-template-columns:360px 1fr;gap:16px;min-height:100dvh;padding:16px;}
.panel{background:var(--panel);border:1px solid #1e293b;border-radius:12px;padding:12px;}
.title{font-weight:700;font-size:18px;margin-bottom:8px;}
.btn{padding:10px 14px;border-radius:10px;border:1px solid #1f2937;background:#0f172a;color:var(--text);
cursor:pointer;font-weight:600;transition:transform .02s ease,opacity .2s ease,background .2s ease;user-select:none;}
.btn:active{transform:scale(0.97);}
.btn[disabled]{opacity:.45;cursor:not-allowed;}
.btn.accent{background:linear-gradient(180deg,#0d2723,#061f1b);border-color:#164e3b;color:#8ef3e3;}
.btn.warn{background:linear-gradient(180deg,#3a0f12,#2a0a0c);border-color:#6e2528;color:#fecaca;}
.btn.ok{background:linear-gradient(180deg,#0d2a12,#0a1e0c);border-color:#1f6e25;color:#bcf7c2;}
.lcd{background:radial-gradient(ellipse at 50% 0%,#0c182a 0%,#0a1220 55%,#08101b 100%);
border:1px solid #263246;border-radius:12px;padding:8px;min-height:140px;position:relative;overflow:hidden;}
.lcd .msg{font-size:15px;line-height:1.4;}
.lcd .big{font-size:18px;font-weight:700;}
.zone{position:absolute;border:2px dashed #334155;border-radius:50%;width:120px;height:120px;opacity:.6;}
.zone.good{border-color:#22c55e;}
.pad{position:absolute;width:110px;height:110px;border-radius:12px;background:linear-gradient(180deg,#eceff3,#d9dfe6);
border:2px solid #94a3b8;box-shadow:0 6px 18px rgba(0,0,0,.35);cursor:grab;display:flex;align-items:center;justify-content:center;
color:#0b1220;font-weight:800;}
.pad:active{cursor:grabbing;}
@media(max-width:900px){.app{grid-template-columns:1fr;}}
</style>
</head>
<body>
<div class="app">
  <!-- PANEL IZQUIERDO -->
  <div class="panel">
    <div class="title">DEA â€” Panel de control</div>

    <div class="lcd">
      <div class="msg" id="lcdText"><span class="big">Encienda el DEA</span><br><small>Use el botÃ³n POWER.</small></div>
    </div>

    <div style="margin-top:10px;display:flex;flex-wrap:wrap;gap:6px;">
      <button class="btn accent" id="btnPower">POWER</button>
      <button class="btn" id="btnAnalyze" disabled>ANALIZAR</button>
      <button class="btn warn" id="btnNobody" disabled>Â¡NADIE TOQUE!</button>
      <button class="btn ok" id="btnShock" disabled>SHOCK</button>
      <button class="btn" id="btnCPR" disabled>RCP 2:00</button>
    </div>
  </div>

  <!-- PANEL DERECHO: TORAX -->
  <div class="panel">
    <div class="title">ColocaciÃ³n de parches</div>
    <div style="position:relative;background:#0b1018;border:1px solid #1f2a44;border-radius:12px;padding:8px;min-height:420px;">
      <div class="zone" id="zoneS" style="left:25%; top:22%;"></div>
      <div class="zone" id="zoneA" style="right:10%; bottom:14%;"></div>
      <svg viewBox="0 0 800 520" style="width:100%;height:100%;">
        <path d="M140,80 C220,20 580,20 660,80 C740,140 760,280 730,420 C680,480 120,480 70,420 C40,280 60,140 140,80 Z"
          fill="#0d1421" stroke="#1f2a44" stroke-width="3"/>
      </svg>
      <div id="padS" class="pad" style="left:20px; top:30px;">S</div>
      <div id="padA" class="pad" style="left:160px; top:30px;">A</div>
    </div>
  </div>
</div>

<script>
// ---- TTS UNIVERSAL (ResponsiveVoice + Fallback)
function speak(text){
  // Preferir ResponsiveVoice
  if(window.responsiveVoice && responsiveVoice.voiceSupport()){
    responsiveVoice.speak(text, 'Spanish Latin American Female', {rate:1.0,pitch:1.0});
    return;
  }
  // Fallback nativo
  if('speechSynthesis' in window){
    const u = new SpeechSynthesisUtterance(text);
    const voices = speechSynthesis.getVoices();
    u.voice = voices.find(v => v.lang?.startsWith('es')) || null;
    u.lang = u.voice?.lang || 'es-AR';
    u.rate = 1; u.pitch = 1;
    speechSynthesis.cancel(); speechSynthesis.speak(u);
  }
}

// ---- Estado simple
const lcd = document.getElementById('lcdText');
const btnPower = document.getElementById('btnPower');
const btnAnalyze = document.getElementById('btnAnalyze');
const btnNobody = document.getElementById('btnNobody');
const btnShock = document.getElementById('btnShock');
const btnCPR = document.getElementById('btnCPR');
const padS = document.getElementById('padS');
const padA = document.getElementById('padA');
const zoneS = document.getElementById('zoneS');
const zoneA = document.getElementById('zoneA');

let state = "off";
let pads = {S:false, A:false};
let cycle = 0;

// ---- Funciones
btnPower.onclick = ()=>{
  if(state==="off"){
    state="pads";
    lcd.innerHTML = "<span class='big'>Coloque los parches</span><br><small>Arrastre S y A a las zonas indicadas.</small>";
    speak("Coloque los parches como se indica");
  } else {
    location.reload();
  }
};

function checkPads(){
  if(pads.S && pads.A && state==="pads"){
    state="ready";
    lcd.innerHTML="<span class='big'>Parches colocados</span><br>Presione ANALIZAR";
    btnAnalyze.disabled=false;
    speak("Parches colocados correctamente. Presione analizar.");
  }
}

// ---- Drag & Drop simple
function dragPad(pad, zone, key){
  pad.onmousedown = e=>{
    e.preventDefault();
    const shiftX = e.clientX - pad.getBoundingClientRect().left;
    const shiftY = e.clientY - pad.getBoundingClientRect().top;
    function moveAt(pageX,pageY){
      pad.style.left = pageX - shiftX - pad.parentElement.getBoundingClientRect().left + 'px';
      pad.style.top  = pageY - shiftY - pad.parentElement.getBoundingClientRect().top + 'px';
    }
    function onMouseMove(e){ moveAt(e.pageX,e.pageY); }
    document.addEventListener('mousemove', onMouseMove);
    pad.onmouseup = ()=>{
      document.removeEventListener('mousemove', onMouseMove);
      pad.onmouseup = null;
      // check overlap
      const z = zone.getBoundingClientRect(), p = pad.getBoundingClientRect();
      const inside = p.left>z.left && p.right<z.right && p.top>z.top && p.bottom<z.bottom;
      if(inside){ pad.style.left=(z.left-pad.parentElement.getBoundingClientRect().left+5)+'px';
        pad.style.top=(z.top-pad.parentElement.getBoundingClientRect().top+5)+'px';
        pad.style.borderColor="#22c55e"; zone.classList.add('good'); pads[key]=true; checkPads();
      }
    };
  };
  pad.ondragstart=()=>false;
}
dragPad(padS,zoneS,'S');
dragPad(padA,zoneA,'A');

btnAnalyze.onclick=()=>{
  if(state!=="ready")return;
  state="analyzing";
  lcd.innerHTML="<span class='big'>No toque al paciente</span><br><small>Presione Â¡NADIE TOQUE! para confirmar.</small>";
  btnAnalyze.disabled=true;
  btnNobody.disabled=false;
  speak("No toque al paciente. Confirme nadie toque para iniciar el anÃ¡lisis.");
};

btnNobody.onclick=()=>{
  if(state!=="analyzing")return;
  btnNobody.disabled=true;
  lcd.innerHTML="<span class='big'>Analizando ritmo...</span>";
  speak("Analizando ritmo");
  setTimeout(()=>{
    state="shock";
    btnShock.disabled=false;
    lcd.innerHTML="<span class='big'>Descarga indicada</span><br><small>Presione SHOCK ahora.</small>";
    speak("Descarga indicada. Presione el botÃ³n de descarga ahora.");
  },4000);
};

btnShock.onclick=()=>{
  if(state!=="shock")return;
  btnShock.disabled=true;
  lcd.innerHTML="<span class='big'>Descarga aplicada</span><br><small>Inicie RCP 2:00</small>";
  speak("Descarga aplicada. Inicie R C P durante dos minutos.");
  btnCPR.disabled=false;
  state="cpr";
};

btnCPR.onclick=()=>{
  if(state!=="cpr")return;
  btnCPR.disabled=true;
  cycle++;
  lcd.innerHTML=`<span class='big'>Ciclo ${cycle}</span><br>RCP en curso...`;
  speak("RCP en curso.");
  setTimeout(()=>{
    lcd.innerHTML="<span class='big'>ReanÃ¡lisis</span><br>Presione ANALIZAR nuevamente.";
    speak("Detenga compresiones. Presione analizar.");
    btnAnalyze.disabled=false;
    state="ready";
  },8000);
};
</script>
</body>
</html>